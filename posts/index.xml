<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/">
  <channel>
    <title>Posts on ç•ªèŒ„ğŸ…æ‚è´§é“º</title>
    <link>https://aidysun.github.io/posts/</link>
    <description>Recent content in Posts on ç•ªèŒ„ğŸ…æ‚è´§é“º</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-us</language>
    <lastBuildDate>Wed, 12 Apr 2023 00:00:00 +0000</lastBuildDate><atom:link href="https://aidysun.github.io/posts/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>å…³äºASCIIã€DBCSã€Unicodeã€UCS-16ã€UTF-8å’ŒEncoding</title>
      <link>https://aidysun.github.io/posts/2023/04/unicode-and-character-sets/</link>
      <pubDate>Wed, 12 Apr 2023 00:00:00 +0000</pubDate>
      
      <guid>https://aidysun.github.io/posts/2023/04/unicode-and-character-sets/</guid>
      <description>æ¯ä¸ªç¨‹åºå‘˜éƒ½åº”è¯¥çŸ¥é“çš„å­—ç¬¦é›†å‘å±•ç®€å²</description>
      <content:encoded><![CDATA[<p>å†™äºäºŒåå¹´å‰(<code>2003å¹´</code>)çš„æ–‡ç« ï¼Œç°åœ¨ä¾ç„¶å—ç”¨ã€‚</p>
<p>ä½ æ˜¯å¦æ›¾æ¢ç©¶è¿‡<code>HTTP</code>è¯·æ±‚ä¸­ç¥ç§˜çš„<code>Content-Type</code>ï¼Ÿä½ æ˜¯å¦æ›¾é‡åˆ°è¿‡æ»¡æ˜¯é—®å· <code>???? ???? ??</code> çš„ç”µå­é‚®ä»¶ï¼ˆæˆ–ç½‘é¡µï¼‰ï¼Ÿ</p>
<p>ä½œè€…å‘ç°å¤šæ•°ç¨‹åºå¼€å‘äººå‘˜å¹¶ä¸æ˜¯å®Œå…¨æ˜ç™½å­—ç¬¦é›†<code>character set</code>ã€ç¼–ç <code>encoding</code>ã€<code>Unicode</code>ã€<code>UTF-8</code>ç­‰ç›¸å…³è¯é¢˜ã€‚</p>
<p>è¿™ç¯‡æ–‡ç« å›é¡¾äº†å­—ç¬¦é›†çš„å‘å±•å†å²ã€‚</p>
<p></p>
<h2 id="asciiamerican-standard-code-for-information-interchangeç¾å›½ä¿¡æ¯äº¤æ¢æ ‡å‡†ä»£ç "><code>ASCII</code>ï¼ˆ<code>American Standard Code for Information Interchange</code>ï¼Œç¾å›½ä¿¡æ¯äº¤æ¢æ ‡å‡†ä»£ç ï¼‰</h2>
<p>å›åˆ°<code>Unix</code>æ­£åœ¨è¢«å‘æ˜çš„ä¸Šå¤æ—¶ä»£ï¼Œä¸€ä¸ªè‹±æ–‡å­—ç¬¦çš„<code>ASCII</code>å€¼å¯ä»¥ç”¨ <code>32-127</code> èŒƒå›´å†…çš„æ•°å­—æ¥è¡¨ç¤ºï¼ŒåŒ…æ‹¬è‹±æ–‡å­—æ¯ã€æ•°å­—å’Œç¬¦å·ã€‚
æ¯”å¦‚ç©ºæ ¼æ˜¯<code>32</code>ï¼Œ<code>A</code>æ˜¯<code>65</code>ï¼Œ<code>a</code>æ˜¯<code>97</code>ã€‚ <code>0-31</code> è¢«ç”¨ä½œæ“ä½œç¬¦ã€‚å¦‚<code>10</code>ä¸ºæ¢è¡Œï¼Œ<code>13</code>ä¸ºå›è½¦ã€‚</p>
<p>è®¡ç®—æœºçš„æœ€å°å¯»å€å•ä½æ˜¯ä¸€å­—èŠ‚ï¼ˆ<code>8</code>ä¸ªæ¯”ç‰¹ï¼‰ï¼Œ<code>127</code>åªéœ€è¦<code>7</code>ä¸ªæ¯”ç‰¹ä½å°±èƒ½è¡¨ç¤ºï¼ˆ<code>2çš„7æ¬¡æ–¹=128</code>ï¼‰ï¼Œæ‰€ä»¥è¿˜æœ‰ä¸€æ¯”ç‰¹ä½ï¼ˆå€¼<code>128-255</code>ï¼‰ç©ºé—²ã€‚</p>
<p>è¿™äº›ç©ºé—²çš„å€¼åœ¨ä¸åŒçš„è¯­è¨€åœ°åŒºè¢«èµ‹äºˆä¸åŒçš„ç”¨æ³•ã€‚æ¯”å¦‚ç¾æ´²åœ°åŒºç”¨<code>130</code>æ¥è¡¨ç¤º<code>Ã©</code>ï¼Œä½†æ˜¯ä»¥è‰²åˆ—çš„ç”µè„‘ç”¨<code>130</code>æ¥è¡¨ç¤ºå¸Œä¼¯æ¥å­—ç¬¦<code>×’</code>ã€‚é‚£ä¹ˆåœ¨ç¾æ´²ç”µè„‘ä¸Šæ˜¾ç¤ºçš„å•è¯<code>rÃ©sumÃ©s</code>ï¼Œåœ¨ä»¥è‰²åˆ—çš„ç”µè„‘ä¸Šå°±æˆäº† <code>r×’sum×’s</code>ã€‚è¿™å¯¼è‡´äº†åŒä¸€æ–‡æ¡£å†…å®¹åœ¨ä¸åŒçš„ç”µè„‘ä¸Šå¯èƒ½æœ‰ä¸åŒçš„æ˜¾ç¤ºã€‚</p>
<h2 id="code-pageä»£ç é¡µ">Code Pageï¼ˆä»£ç é¡µï¼‰</h2>
<p><code>ANSI</code>ï¼ˆ<code>American National Standards Institute</code>ï¼Œç¾å›½å›½å®¶æ ‡å‡†å­¦ä¼šï¼‰åœ¨åˆ¶å®šæ ‡å‡†çš„æ—¶å€™ï¼Œå¼•å…¥äº†ä»£ç é¡µã€‚</p>
<p>è¿™äº›ä»£ç é¡µ<code>128</code>ä»¥ä¸‹æ˜¯ä¸€æ ·çš„ï¼Œåªæœ‰<code>128</code>ä»¥ä¸Šä¸åŒã€‚å¦‚ï¼Œä»¥è‰²åˆ—ä½¿ç”¨<code>code page 862</code>ï¼Œå¸Œè…Šä½¿ç”¨ <code>code page 737</code>ã€‚</p>
<p>è¿™æ ·åœ¨åŒä¸€ç”µè„‘ä¸Šå¯ä»¥æœ‰å¤šä¸ªä¸åŒçš„ä»£ç é¡µå¯ä¾›é€‰æ‹©ã€‚</p>
<h2 id="dbcsdouble-byte-character-setåŒå­—èŠ‚å­—ç¬¦é›†"><code>DBCS</code>ï¼ˆ<code>Double Byte Character Set</code>ï¼ŒåŒå­—èŠ‚å­—ç¬¦é›†ï¼‰</h2>
<p>ä½†æ˜¯ï¼Œç”±äºäºšæ´²è¯­è¨€æœ‰æˆåƒä¸Šä¸‡çš„å­—ç¬¦ï¼Œæ²¡åŠæ³•ç”¨ä¸€å­—èŠ‚ï¼ˆ<code>8</code>æ¯”ç‰¹ï¼‰å®Œå…¨è¡¨ç¤ºã€‚</p>
<p><code>DBCS</code> æ˜¯å¯¹è‹±æ–‡å­—ç¬¦ä½¿ç”¨å•å­—èŠ‚ï¼Œå…¶ä»–å­—ç¬¦ï¼ˆå¦‚ä¸­æ—¥éŸ©æ–‡ï¼‰ä½¿ç”¨åŒå­—èŠ‚ã€‚è®¿é—®æ–‡æœ¬æ—¶ï¼Œåªèƒ½ä»å‰å‘åå¤„ç†ã€‚å› ä¸ºéœ€è¦ä¸€ç›´åˆ¤æ–­å½“å‰å­—èŠ‚æ˜¯ä¸æ˜¯å‰å¯¼å­—èŠ‚ï¼Œå¯¹äºæ—¢æœ‰å¯èƒ½æ˜¯å‰å¯¼ä¹Ÿæœ‰å¯èƒ½æ˜¯åç»­çš„å­—èŠ‚ï¼Œåªèƒ½é€šè¿‡ä¸Šä¸‹æ–‡åšåˆ¤æ–­ã€‚</p>
<p>å¯¹è®¡ç®—æœºç¨‹åºåŠç¨‹åºå‘˜æ¥è¯´ï¼Œæ“ä½œèµ·æ¥æ¯”è¾ƒéº»çƒ¦ã€å®¹æ˜“å‡ºé”™ã€‚</p>
<h2 id="unicodeç»Ÿä¸€ç ä¸‡å›½ç "><code>Unicode</code>ï¼ˆç»Ÿä¸€ç ã€ä¸‡å›½ç ï¼‰</h2>
<p>ä¸€å¥—å¯ä»¥é€‚ç”¨äºå…¨ä¸–ç•Œæ‰€æœ‰å›½å®¶çš„å­—ç¬¦é›†ã€‚</p>
<p>å¯¹ <code>Unicode</code> æœ€å¸¸è§çš„è¯¯è§£æ˜¯ï¼šæ¯ä¸ªå­—ç¬¦å ç”¨<code>16</code>æ¯”ç‰¹ï¼Œå› æ­¤èƒ½è¡¨ç¤ºçš„å­—ç¬¦ä¸ªæ•°æ˜¯ <code>2çš„16æ¬¡æ–¹=65536</code>ä¸ªã€‚å®é™…ä¸Šï¼Œè¿™æ˜¯ä¸å¯¹çš„ã€‚</p>
<p><code>Unicode</code> ä¸­å¯¹æ‰€æœ‰å­—æ¯è¡¨ä¸­çš„æ¯ä¸ªå­—ç¬¦åˆ†é…ä¸€ä¸ªæ•°å­—â€”â€”<code>code point</code>ï¼Œå¦‚ <code>A</code> çš„<code>code point</code> æ˜¯ <code>U+0041</code>ï¼›<code>è¿ª</code>çš„ <code>code point</code> æ˜¯ <code>U+8FEA</code>ã€‚</p>
<p><code>Unicode</code> ä¸­çš„å­—ç¬¦ï¼Œæ˜¯ä¸€ä¸ªæ¦‚å¿µå®šä¹‰ã€‚æ¯”å¦‚å­—ç¬¦<code>A</code>ï¼Œå¾ˆæ˜æ˜¾<code>A</code>ä¸åŒäº<code>B</code>ï¼Œä¹Ÿä¸åŒäº<code>a</code>ï¼Œä½†æ˜¯æ— è®ºæ˜¯æ–œä½“çš„<code>A</code>ã€ç²—ä½“çš„<code>A</code>ã€è¿˜æ˜¯æ­£å¸¸çš„<code>A</code>ï¼Œå®ƒä»¬åº”è¯¥æ˜¯ä¸€æ ·çš„ï¼Œéƒ½æ˜¯å­—ç¬¦<code>A</code>ã€‚å¯¹äºå­—ä½“<code>Times New Roman</code>ä¸­çš„<code>A</code>ï¼Œåº”è¯¥å’Œå­—ä½“<code>Helvetica</code>ä¸­çš„<code>A</code>ä¸€æ ·ï¼Œéƒ½æ˜¯å­—ç¬¦<code>A</code>ã€‚(å¯¹äºå­—ç¬¦<code>A</code>ï¼Œ<code>Unicode</code>åªå®šä¹‰<code>U+0041</code>æ˜¯å­—ç¬¦<code>A</code>ï¼Œè€Œå…·ä½“çš„è¿™ä¸ªå­—ç¬¦æ˜¾ç¤ºå‡ºæ¥æ—¶ä»€ä¹ˆæ ·å­ï¼Œæ˜¯å®šä¹‰åœ¨å­—ä½“æ–‡ä»¶ä¸­çš„)</p>
<h2 id="ucs-2--utf-16"><code>UCS-2</code> / <code>UTF-16</code></h2>
<p>é‚£ä¹ˆ <code>He</code> ç”¨ <code>Unicode</code> è¡¨ç¤ºå°±æ˜¯ <code>00 48 00 65</code>ã€‚</p>
<p>å¯¹å—ï¼Ÿæ†‹ç€æ€¥ã€‚é‚£å®ƒä¸ºå•¥ä¸èƒ½æ˜¯ <code>48 00 65 00</code> å‘¢ï¼ŸæŠ€æœ¯ä¸Šæ¥è¯´æ²¡æœ‰é—®é¢˜ï¼Œè€Œå®é™…ä¸Šä¹Ÿæ˜¯ä¸¤ç§æ–¹å¼éƒ½å­˜åœ¨ï¼ˆå› ä¸ºç‰¹å®šçš„ <code>CPU</code> ç”¨ç‰¹å®šçš„é¡ºåºä¼šæ›´å¿«ï¼‰â€”â€”å¤§ç«¯åºï¼ˆ<code>big-edian</code>ï¼‰å’Œ å°ç«¯åºï¼ˆ<code>little-endian</code>ï¼‰ã€‚</p>
<p>ä¸ºäº†åŒºåˆ†ï¼Œåœ¨æ–‡æœ¬å¼€å¤´åŠ ä¸Šå­—èŠ‚é¡ºåºæ ‡è®°ä½ï¼Œå¤§ç«¯åºç”¨ <code>FE FF</code>ï¼Œå°ç«¯åºç”¨ <code>FF FE</code>ã€‚</p>
<p>è¿™ç§æ–¹å¼å¯¹äºæ–°ç”Ÿæˆçš„æ–‡æ¡£æ²¡æœ‰ä»»ä½•é—®é¢˜ï¼Œä½†æ˜¯æ— æ³•å…¼å®¹å·²æœ‰çš„<code>ASCII</code>å’Œ<code>DBCS</code>æ–‡æ¡£ã€‚</p>
<h2 id="utf-8unicode-transformation-format-8-bit">UTF-8ï¼ˆUnicode Transformation Format 8-bitï¼‰</h2>
<p>æ‰€ä»¥ï¼Œå‡ºç°äº†å¦ä¸€ç§å®ç° <code>Unicode</code> å­—ç¬¦é›†çš„ç³»ç»Ÿâ€”â€”<code>UTF-8</code>ã€‚å®ƒé‡‡ç”¨å˜é•¿çš„ç¼–ç ï¼Œç”¨ä¸€ä¸ªå­—èŠ‚å­˜å‚¨ <code>code point 0-127</code>ï¼Œå¯¹ <code>128</code> ä»¥ä¸Šçš„ä½¿ç”¨ <code>2å­—èŠ‚ã€3å­—èŠ‚ï¼Œæœ€å¤šåˆ° 6å­—èŠ‚</code>ã€‚</p>
<p>æ¯”å¦‚ï¼Œè¡¨ç¤ºå­—ç¬¦ <code>â‚¤</code> çš„ <code>Unicode</code> åå…­è¿›åˆ¶å€¼ä¸º <code>U+20A4</code>ï¼Œå…¶äºŒè¿›åˆ¶ä¸º <code>0010 0000 1010 0100</code>ã€‚ç”¨<code>UTF-8</code> æ¥è¡¨ç¤ºå­—ç¬¦<code>â‚¤</code>çš„è¯ï¼Œéœ€è¦<code>3</code>ä¸ªå­—èŠ‚ï¼š</p>
<ul>
<li>ç¬¬ä¸€ä¸ªå­—èŠ‚çš„å‰å››ä½ï¼Œç”¨<code>3</code>æ¯”ç‰¹<code>1</code>ï¼ˆä»£è¡¨<code>3</code>ä¸ªå­—èŠ‚ï¼‰åŠ ä¸€ä¸ª<code>0</code>ï¼š<code>1110</code>ã€‚åå››ä½æ¥<code>20A4</code>çš„å‰å››å­èŠ‚ï¼š<code>0010</code>ã€‚å¾—åˆ°<code>1110 0010</code>ã€‚</li>
<li>ç¬¬äºŒå­èŠ‚ä»¥<code>10</code>å¼€å¤´ï¼Œåå…­å­—èŠ‚æ¥<code>20A4</code>çš„å…­å­—èŠ‚ <code>0000 10</code>ï¼Œå¾—åˆ°<code>1000 0010</code>ã€‚</li>
<li>ç¬¬ä¸‰å­èŠ‚è¿˜æ˜¯ä»¥<code>10</code>å¼€å¤´ï¼Œåå…­å­—èŠ‚æ¥<code>20A4</code>æœ€åå…­å­—èŠ‚<code>10 0100</code>ï¼Œå¾—åˆ°<code>1010 0100</code>ã€‚</li>
</ul>
<p>æœ€ç»ˆå¾—åˆ°å­—ç¬¦<code>â‚¤</code>çš„<code>UTF-8</code>è¡¨ç¤ºä¸º<code>1110-0010 1000-0010 1010-0100</code>ã€‚</p>
<blockquote>
<p>å¯¹äºè‹±æ–‡æ–‡æ¡£æ¥è¯´ï¼Œ<code>UTF-8</code> å’Œ <code>ASCII</code>æ˜¯ä¸€æ ·çš„ï¼Œä¸éœ€è¦ä»»ä½•è½¬æ¢ã€‚</p>
</blockquote>
<h3 id="utf-8-æ¯”-utf-16-çœç©ºé—´å—">UTF-8 æ¯” UTF-16 çœç©ºé—´å—ï¼Ÿ</h3>
<p><strong>ä¸ä¸€å®š</strong>ã€‚</p>
<table>
<thead>
<tr>
<th style="text-align:center">å­—ç¬¦ä¸²</th>
<th>UTF-8</th>
<th>UTF-16</th>
<th>ç©ºé—´æ¯”è¾ƒ</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><code>AI</code></td>
<td><code>4149</code></td>
<td><code>0041 0049</code></td>
<td><code>UTF-8</code>&lt;<code>UTF-16</code></td>
</tr>
<tr>
<td style="text-align:center"><code>å°„é›•</code></td>
<td><code>E5B0 84E9 9B95</code></td>
<td><code>5C04 96D5</code></td>
<td><code>UTF-8</code>&gt;<code>UTF-16</code></td>
</tr>
</tbody>
</table>
<blockquote>
<p>å¦‚æœå­˜å‚¨æ•°æ®è‹±æ–‡å­—ç¬¦è¾ƒå¤šï¼Œ<code>UTF-8</code>è‚¯å®šä¼šæ¯”<code>UTF-16</code>èŠ‚çœç©ºé—´ã€‚</p>
</blockquote>
<h2 id="encodingsç¼–ç ">Encodingsï¼ˆç¼–ç ï¼‰</h2>
<p></p>
<p><code>Unicode</code>æ˜¯å­—ç¬¦é›†ï¼Œä¸Šé¢è¯´çš„ <code>UCS-2</code>ã€<code>UTF-8</code>ç­‰æ˜¯å®ç°<code>Unicode</code>çš„æ–¹æ³•â€”â€”<code>Encoding</code>ã€‚<code>Encoding</code>æœ‰å¤šç§å®ç°ï¼Œå¦‚<code>UTF-7</code>ã€<code>UTF-32</code>ã€<code>ISO8859-1</code>ã€‚</p>
<p>æ‰€ä»¥ï¼Œå¿…é¡»ç¡®å®šæ‰€ç”¨çš„<code>Encoding</code>æ‰èƒ½æ­£ç¡®å¤„ç†ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚</p>
<p>åœ¨æµè§ˆå™¨ä¸­çœ‹åˆ°è¿™æ¯ä¸ªç½‘é¡µä¼šæœ‰<code>Encoding</code>çš„ä¿¡æ¯ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="ln">1</span><span class="cl"><span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="p">&lt;</span><span class="nt">meta</span> <span class="na">http-equiv</span><span class="o">=</span><span class="s">&#34;Content-Type&#34;</span> <span class="na">content</span><span class="o">=</span><span class="s">&#34;text/html; charset=utf-8&#34;</span><span class="p">&gt;</span>
</span></span></code></pre></div><p>å¯æ˜¯ï¼Œåœ¨ä¸çŸ¥é“<code>encoding</code>çš„æƒ…å†µä¸‹æ€ä¹ˆå»è¯»è¿™ä¸ª<code>HTML</code>æ–‡ä»¶æ¥å–åˆ°<code>encoding</code>çš„ä¿¡æ¯å‘¢ï¼Ÿ</p>
<p>å¹¸è¿çš„æ˜¯ï¼Œç»å¤§å¤šæ•°<code>encoding</code>å¯¹ <code>32-127</code> çš„<code>code point</code>çš„å¤„ç†æ–¹å¼æ˜¯ä¸€æ ·çš„ï¼Œå¯ä»¥æŠŠæ–‡ä»¶å¼€å¤´çš„å†…å®¹å½“ä½œ<code>ASCII</code>æ¥å¤„ç†ã€‚æ‰€ä»¥<code>encoding</code>ä¿¡æ¯è¶Šæ—©å‡ºç°è¶Šå¥½ï¼Œé¿å…å‡ºç°åœ¨ä»»ä½•<code>code point</code>å¤§äº<code>127</code>çš„å­—ç¬¦ä¹‹åã€‚</p>
<p>å¦å¤–ï¼Œ<code>HTTP</code>è¯·æ±‚å¤´ä¸­ä¹Ÿå¯ä»¥åŒ…å«<code>encoding</code>ä¿¡æ¯ï¼ˆ<code>Content-Type</code>ï¼‰ã€‚</p>
<p>æ—©æœŸçš„æµè§ˆå™¨éƒ½æœ‰è®¾ç½®<code>encoding</code>çš„èœå•ï¼Œä»¥åº”å¯¹æ‰¾ä¸åˆ°<code>encoding</code>å®šä¹‰è€Œæ— æ³•æ­£ç¡®å¤„ç†çš„æƒ…å†µã€‚å¤§éƒ¨åˆ†ç°ä»£æµè§ˆå™¨ï¼ˆå¦‚<code>Chrome</code>ï¼‰å·²ç»å»æ‰è¯¥èœå•ï¼Œå¯ä»¥æ ¹æ®ä¸Šä¸‹æ–‡åˆ¤æ–­å‡ºæ­£ç¡®<code>encoding</code>äº†ã€‚</p>
<h2 id="åŸæ–‡é“¾æ¥">åŸæ–‡é“¾æ¥</h2>
<ul>
<li><a href="https://www.joelonsoftware.com/2003/10/08/the-absolute-minimum-every-software-developer-absolutely-positively-must-know-about-unicode-and-character-sets-no-excuses/">The Absolute Minimum Every Software Developer Absolutely, Positively Must Know About Unicode and Character Sets (No Excuses!)</a></li>
<li><a href="https://mp.weixin.qq.com/s?__biz=Mzg5NDE1MTU2NQ==&amp;mid=2247483816&amp;idx=1&amp;sn=2be8183562976b65cbdc37c711ff79fb&amp;chksm=c022bf4af755365cf1440172cb044f204758796097fb42dfc028ff31c58505b5648e2478f10a&amp;token=258030414&amp;lang=zh_CN#rd">æ¯ä¸ªç¨‹åºå‘˜éƒ½åº”è¯¥çŸ¥é“çš„å­—ç¬¦é›†å‘å±•ç®€å²</a></li>
</ul>
<blockquote>
</blockquote>
]]></content:encoded>
    </item>
    
    <item>
      <title>è®¾è®¡æ¨¡å¼ï¼šè§‚å¯Ÿè€…æ¨¡å¼ã€è®¢é˜…-å‘å¸ƒæ¨¡å¼ã€äº‹ä»¶ç›‘å¬æ¨¡å¼</title>
      <link>https://aidysun.github.io/posts/2023/04/design-pattern-observer/</link>
      <pubDate>Tue, 11 Apr 2023 00:00:00 +0000</pubDate>
      
      <guid>https://aidysun.github.io/posts/2023/04/design-pattern-observer/</guid>
      <description>Design Pattern: Observer Pattern</description>
      <content:encoded><![CDATA[<p>è§‚å¯Ÿè€…æ¨¡å¼ï¼ˆ<code>Observer Pattern</code>ï¼‰è§£å†³çš„å¯¹è±¡é—´çš„ä¸€å¯¹å¤šçš„å…³ç³»ï¼Œå³ä¸€ä¸ªè¢«è§‚å¯Ÿè€…ä¸å¤šä¸ªè§‚å¯Ÿè€…ã€‚æœ€ç›´æ¥çš„ä¾‹å­å°±æ˜¯å…¬ä¼—å·ï¼ˆ<code>Subject</code>ï¼‰åŠè®¢é˜…è€…ï¼ˆ<code>Observer</code>ï¼‰ã€‚</p>
<p>å¯¹äºè§‚å¯Ÿè€…æ¨¡å¼ã€å‘å¸ƒ-è®¢é˜…æ¨¡å¼/äº‹ä»¶ç›‘å¬æ¨¡å¼ï¼Œä¸ºåªæ˜¯ç›¸åŒæŠ€æœ¯å®ç°åŸºç¡€ä¸Šçš„ä¸åŒæ¼”åŒ–ï¼Œå±äºåŒä¸€ç±»è®¾è®¡æ¨¡å¼ã€‚</p>
<hr>
<h2 id="è§‚å¯Ÿè€…æ¨¡å¼10">è§‚å¯Ÿè€…æ¨¡å¼1.0</h2>
<p>æ¶‰åŠä¸¤ä¸ªè§’è‰²ï¼š</p>
<ul>
<li>è¢«è§‚å¯Ÿè€…: Subject/Observable/Publisher, ä¼šæœ‰çŠ¶æ€/æ•°æ®å˜åŒ–çš„å¯¹è±¡ã€‚</li>
<li>è§‚å¯Ÿè€…: Observer/Subscriberï¼Œå…³å¿ƒ<code>è¢«è§‚æµ‹å¯¹è±¡</code>çš„å˜åŒ–ã€‚</li>
</ul>
<p>æœ€åŸºç¡€çš„å®ç°éœ€è¦å®šä¹‰ 2 ä¸ªåŸºç±» <code>Subject</code> å’Œ <code>Observer</code>ã€‚</p>
<blockquote>
<p><code>C++</code>å®ç°</p>
</blockquote>
<h3 id="è§‚å¯Ÿè€…">è§‚å¯Ÿè€…</h3>
<p>å…ˆå®šä¹‰æ¥å£ç±» <code>class Observer</code>ï¼Œè¯¥ç±»æ²¡æœ‰é»˜è®¤å®ç°ï¼Œå­ç±»å¿…é¡»å®ç° <code>update()</code> æ¥å£ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="ln">1</span><span class="cl"><span class="c1">// Observer.h 
</span></span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="k">class</span> <span class="nc">Observer</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl">  <span class="k">virtual</span> <span class="kt">void</span> <span class="n">update</span><span class="p">(</span><span class="n">string</span> <span class="n">msg</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">// abstract virtual
</span></span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="c1"></span><span class="p">};</span>
</span></span></code></pre></div><h3 id="è¢«è§‚å¯Ÿå¯¹è±¡">è¢«è§‚å¯Ÿå¯¹è±¡</h3>
<p>åŸºç±» <code>Subject</code>ï¼Œå®ƒéœ€è¦çŸ¥é“æœ‰é‚£äº›è§‚å¯Ÿè€…ï¼Œåœ¨éœ€è¦é€šçŸ¥çš„æ—¶å€™éå†è§‚å¯Ÿè€…åˆ—è¡¨å‘é€é€šçŸ¥ã€‚
æœ‰è‡ªå·±çš„å®ç°ï¼Œå®šä¹‰å­ç±»æ—¶ä¸éœ€è¦å¤å†™åŸºç±»çš„æ–¹æ³•ï¼Œç›´æ¥ä½¿ç”¨å³å¯ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="c1">// Subject.h
</span></span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="k">class</span> <span class="nc">Subject</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">  <span class="k">virtual</span> <span class="kt">void</span> <span class="n">addObserver</span><span class="p">(</span><span class="n">Observer</span> <span class="o">*</span> <span class="n">observer</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">  <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">removeObserver</span><span class="p">(</span><span class="n">Observer</span> <span class="o">*</span> <span class="n">observer</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">  <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">notify</span><span class="p">(</span><span class="n">string</span> <span class="n">msg</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">
</span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">  <span class="n">std</span><span class="o">::</span><span class="n">set</span><span class="o">&lt;</span><span class="n">Observer</span><span class="o">*&gt;</span> <span class="n">observers</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="p">};</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="c1">// Subjet.cpp
</span></span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="kt">void</span> <span class="n">Subject</span><span class="o">::</span><span class="n">addObserver</span><span class="p">(</span><span class="n">Observer</span><span class="o">*</span> <span class="n">observer</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">  <span class="n">observers</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">observer</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="kt">void</span> <span class="n">Subject</span><span class="o">::</span><span class="n">removeObserver</span><span class="p">(</span><span class="n">Observer</span><span class="o">*</span> <span class="n">observer</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">  <span class="n">observers</span><span class="p">.</span><span class="n">erase</span><span class="p">(</span><span class="n">observer</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">
</span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="kt">void</span> <span class="n">Subject</span><span class="o">::</span><span class="n">notify</span><span class="p">(</span><span class="n">string</span> <span class="n">msg</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">  <span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="nl">obs</span><span class="p">:</span> <span class="n">observers</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">    <span class="n">obs</span><span class="o">-&gt;</span><span class="n">update</span><span class="p">(</span><span class="n">msg</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h3 id="åº”ç”¨">åº”ç”¨</h3>
<p>ä»¥å…¬ä¼—å·å’Œè®¢é˜…è€…ä¸ºä¾‹ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="ln"> 1</span><span class="cl">
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="c1">// å…¬ä¼—å·
</span></span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="c1"></span><span class="k">class</span> <span class="nc">Publisher</span><span class="o">:</span> <span class="k">public</span> <span class="n">Subject</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">    <span class="kt">void</span> <span class="n">addArticle</span><span class="p">(</span><span class="k">const</span> <span class="n">string</span><span class="o">&amp;</span> <span class="n">article</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">        <span class="n">articles</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">article</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">        <span class="n">notify</span><span class="p">(</span><span class="n">article</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">    <span class="n">vector</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;</span> <span class="n">articles</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="c1">// è®¢é˜…è€…
</span></span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="c1"></span><span class="k">class</span> <span class="nc">Subscriber</span><span class="o">:</span> <span class="k">public</span> <span class="n">Observer</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="n">Subscriber</span><span class="p">(</span><span class="n">string</span> <span class="n">name</span><span class="p">)</span><span class="o">:</span> <span class="n">name</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="p">{}</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">
</span></span><span class="line"><span class="ln">18</span><span class="cl">    <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">update</span><span class="p">(</span><span class="n">string</span> <span class="n">article</span><span class="p">)</span> <span class="k">override</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">        <span class="n">readArticle</span><span class="p">(</span><span class="n">article</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">
</span></span><span class="line"><span class="ln">22</span><span class="cl">    <span class="kt">void</span> <span class="nf">readArticle</span><span class="p">(</span><span class="n">string</span> <span class="n">article</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">name</span> <span class="o">&lt;&lt;</span> <span class="s">&#34; is reading article : &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">article</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">
</span></span><span class="line"><span class="ln">26</span><span class="cl"><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">    <span class="n">string</span> <span class="n">name</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">
</span></span><span class="line"><span class="ln">30</span><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl">
</span></span><span class="line"><span class="ln">32</span><span class="cl">    <span class="n">Publisher</span> <span class="n">publisher</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">33</span><span class="cl">
</span></span><span class="line"><span class="ln">34</span><span class="cl">    <span class="n">Subscriber</span> <span class="n">sub1</span><span class="p">(</span><span class="s">&#34;Tom&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">35</span><span class="cl">    <span class="n">publisher</span><span class="p">.</span><span class="n">addObserver</span><span class="p">(</span><span class="o">&amp;</span><span class="n">sub1</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">36</span><span class="cl">    <span class="n">publisher</span><span class="p">.</span><span class="n">addArticle</span><span class="p">(</span><span class="s">&#34;Article 1&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">37</span><span class="cl">
</span></span><span class="line"><span class="ln">38</span><span class="cl">    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">39</span><span class="cl">
</span></span><span class="line"><span class="ln">40</span><span class="cl">    <span class="n">Subscriber</span> <span class="n">sub2</span><span class="p">(</span><span class="s">&#34;Jerry&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">41</span><span class="cl">    <span class="n">publisher</span><span class="p">.</span><span class="n">addObserver</span><span class="p">(</span><span class="o">&amp;</span><span class="n">sub2</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">42</span><span class="cl">    <span class="n">publisher</span><span class="p">.</span><span class="n">addArticle</span><span class="p">(</span><span class="s">&#34;Article 2&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">43</span><span class="cl">
</span></span><span class="line"><span class="ln">44</span><span class="cl">    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">45</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>æ‰§è¡Œç»“æœï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="ln">1</span><span class="cl"><span class="n">Tom</span> <span class="n">is</span> <span class="n">reading</span> <span class="nl">article</span> <span class="p">:</span> <span class="n">Article</span> <span class="mi">1</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">
</span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="n">Tom</span> <span class="n">is</span> <span class="n">reading</span> <span class="nl">article</span> <span class="p">:</span> <span class="n">Article</span> <span class="mi">2</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="n">Jerry</span> <span class="n">is</span> <span class="n">reading</span> <span class="nl">article</span> <span class="p">:</span> <span class="n">Article</span> <span class="mi">2</span>
</span></span></code></pre></div><hr>
<h2 id="è§‚å¯Ÿè€…æ¨¡å¼20">è§‚å¯Ÿè€…æ¨¡å¼2.0</h2>
<p>ä¸Šé¢çš„<code>Observer</code>æä¾›äº†ä¸€ä¸ªå¸¦æœ‰ä¸€ä¸ªå‚æ•°çš„<code>update</code>æ¥å£ï¼š <code>virtual void update(string msg)</code>ã€‚
è™½ç„¶åœ¨åº”ç”¨ä¸­å¯ä»¥é€šè¿‡ä¼ é€’ä¸åŒå‚æ•°æ¥åŒºåˆ†ä¸åŒçš„é€šçŸ¥ï¼Œæ¯”å¦‚ï¼š<code>update(&quot;å…¨éƒ¨è®¢é˜…è€…å¯è§æ›´æ–°&quot;)</code>ï¼Œ<code>update(&quot;VIPè®¢é˜…è€…å¯è§æ›´æ–°&quot;)</code>ï¼Œä½†å¯¹äºå¤æ‚ä¸€ç‚¹çš„éœ€è¦å¤šå‚æ•°ä¼ é€’çš„åœºæ™¯å°±ä¸é€‚ç”¨äº†ã€‚</p>
<p>é‚£ä¹ˆå¯ä»¥é€šè¿‡å¼•å…¥<code>Event</code>ç±»å‹ï¼Œä»¥æ›´çµæ´»çš„å®šä¹‰ä¸åŒçš„ã€å¤æ‚çš„é€šçŸ¥ç±»å‹ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="c1">// Event æ¥å£å®šä¹‰
</span></span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="k">enum</span> <span class="nc">EventType</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">    <span class="n">ARTICLE_UPDATED</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">    <span class="n">VIP_ARTICLE_UPDATED</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="k">class</span> <span class="nc">Event</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">    <span class="k">virtual</span> <span class="n">EventType</span> <span class="n">type</span><span class="p">()</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">    <span class="k">virtual</span> <span class="o">~</span><span class="n">Event</span><span class="p">()</span> <span class="p">{}</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="c1">// å…·ä½“çš„ Event ç±»å‹
</span></span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="c1"></span><span class="k">class</span> <span class="nc">ArticleUpdatedEvent</span><span class="o">:</span> <span class="k">public</span> <span class="n">Event</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="k">virtual</span> <span class="n">EventType</span> <span class="n">type</span><span class="p">()</span> <span class="k">override</span> <span class="p">{</span> <span class="k">return</span> <span class="n">ARTICLE_UPDATED</span><span class="p">;</span> <span class="p">}</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="n">string</span> <span class="nf">getArticle</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">article</span><span class="p">;</span> <span class="p">}</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">    <span class="kt">void</span> <span class="nf">setArticle</span><span class="p">(</span><span class="k">const</span> <span class="n">string</span><span class="o">&amp;</span> <span class="n">article</span><span class="p">)</span> <span class="p">{</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">article</span> <span class="o">=</span> <span class="n">article</span><span class="p">;</span> <span class="p">}</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl"><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">    <span class="n">string</span> <span class="n">article</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">
</span></span><span class="line"><span class="ln">25</span><span class="cl"><span class="k">class</span> <span class="nc">VipArticleUpdatedEvent</span><span class="o">:</span> <span class="k">public</span> <span class="n">Event</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">    <span class="k">virtual</span> <span class="n">EventType</span> <span class="n">type</span><span class="p">()</span> <span class="k">override</span> <span class="p">{</span> <span class="k">return</span> <span class="n">VIP_ARTICLE_UPDATED</span><span class="p">;</span> <span class="p">}</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">
</span></span><span class="line"><span class="ln">29</span><span class="cl">    <span class="n">string</span> <span class="nf">getArticle</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">article</span><span class="p">;</span> <span class="p">}</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">    <span class="kt">void</span> <span class="nf">setArticle</span><span class="p">(</span><span class="k">const</span> <span class="n">string</span><span class="o">&amp;</span> <span class="n">article</span><span class="p">)</span> <span class="p">{</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">article</span> <span class="o">=</span> <span class="n">article</span><span class="p">;</span> <span class="p">}</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl">
</span></span><span class="line"><span class="ln">32</span><span class="cl">    <span class="kt">int</span> <span class="nf">getReward</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">reward</span><span class="p">;</span> <span class="p">}</span>
</span></span><span class="line"><span class="ln">33</span><span class="cl">    <span class="kt">void</span> <span class="nf">setReward</span><span class="p">(</span><span class="kt">int</span> <span class="n">reward</span><span class="p">)</span> <span class="p">{</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">reward</span> <span class="o">=</span> <span class="n">reward</span><span class="p">;</span> <span class="p">}</span>
</span></span><span class="line"><span class="ln">34</span><span class="cl"><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="ln">35</span><span class="cl">    <span class="n">string</span> <span class="n">article</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">36</span><span class="cl">    <span class="kt">int</span> <span class="n">reward</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">37</span><span class="cl"><span class="p">};</span>
</span></span></code></pre></div><p>å°†<code>Observer</code>æ›´æ–°ä¸ºï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="ln">1</span><span class="cl"><span class="c1">// Observer.h 
</span></span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="k">class</span> <span class="nc">Observer</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl">  <span class="c1">// virtual void update(string msg) = 0; // abstract virtual
</span></span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="c1"></span>  <span class="k">virtual</span> <span class="kt">void</span> <span class="n">update</span><span class="p">(</span><span class="n">shared_pointer</span><span class="o">&lt;</span><span class="n">Event</span><span class="o">&gt;</span> <span class="n">event</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">// abstract virtual
</span></span></span><span class="line"><span class="ln">7</span><span class="cl"><span class="c1"></span><span class="p">};</span>
</span></span></code></pre></div><p><code>Subject</code>æ›´æ–°ä¸ºï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="ln">1</span><span class="cl"><span class="c1">// Subject.h
</span></span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="k">class</span> <span class="nc">Subject</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl">  <span class="p">...</span>
</span></span><span class="line"><span class="ln">6</span><span class="cl">  <span class="c1">// virtual void notify(string msg);
</span></span></span><span class="line"><span class="ln">7</span><span class="cl"><span class="c1"></span>  <span class="k">virtual</span> <span class="kt">void</span> <span class="n">notify</span><span class="p">(</span><span class="n">shared_pointer</span><span class="o">&lt;</span><span class="n">Event</span><span class="o">&gt;</span> <span class="n">event</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">8</span><span class="cl">  <span class="p">...</span>
</span></span><span class="line"><span class="ln">9</span><span class="cl"><span class="p">};</span></span></span></code></pre></div>
<p>åº”ç”¨åˆ°<code>å…¬ä¼—å·â€”â€”è®¢é˜…è€…</code>ä¸Šï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="c1">// å…¬ä¼—å·
</span></span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="k">class</span> <span class="nc">Publisher</span><span class="o">:</span> <span class="k">public</span> <span class="n">Subject</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">    <span class="kt">void</span> <span class="n">addArticle</span><span class="p">(</span><span class="k">const</span> <span class="n">string</span><span class="o">&amp;</span> <span class="n">article</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">        <span class="k">auto</span> <span class="n">e</span> <span class="o">=</span> <span class="n">make_shared</span><span class="o">&lt;</span><span class="n">ArticleUpdatedEvent</span><span class="o">&gt;</span><span class="p">();</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">        <span class="n">e</span><span class="o">-&gt;</span><span class="n">setArticle</span><span class="p">(</span><span class="n">article</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">        <span class="n">notify</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">    
</span></span><span class="line"><span class="ln">11</span><span class="cl">    <span class="kt">void</span> <span class="nf">addVipArticleWithReward</span><span class="p">(</span><span class="k">const</span> <span class="n">string</span><span class="o">&amp;</span> <span class="n">article</span><span class="p">,</span> <span class="kt">int</span> <span class="n">reward</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">        <span class="k">auto</span> <span class="n">e</span> <span class="o">=</span> <span class="n">make_shared</span><span class="o">&lt;</span><span class="n">VipArticleUpdatedEvent</span><span class="o">&gt;</span><span class="p">();</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">        <span class="n">e</span><span class="o">-&gt;</span><span class="n">setArticle</span><span class="p">(</span><span class="n">article</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">        <span class="n">e</span><span class="o">-&gt;</span><span class="n">setReward</span><span class="p">(</span><span class="n">reward</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">        <span class="n">notify</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">
</span></span><span class="line"><span class="ln">19</span><span class="cl"><span class="c1">// è®¢é˜…è€…
</span></span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="c1"></span><span class="k">class</span> <span class="nc">Subscriber</span><span class="o">:</span> <span class="k">public</span> <span class="n">Observer</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">    <span class="n">Subscriber</span><span class="p">(</span><span class="n">string</span> <span class="n">name</span><span class="p">)</span><span class="o">:</span> <span class="n">name</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="p">{}</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">
</span></span><span class="line"><span class="ln">24</span><span class="cl">   <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">update</span><span class="p">(</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Event</span><span class="o">&gt;</span> <span class="n">event</span><span class="p">)</span> <span class="k">override</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">        <span class="k">switch</span> <span class="p">(</span><span class="n">event</span><span class="o">-&gt;</span><span class="n">type</span><span class="p">())</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">            <span class="k">case</span> <span class="n">EventType</span><span class="o">::</span><span class="nl">ARTICLE_UPDATED</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">                <span class="k">auto</span> <span class="n">e</span> <span class="o">=</span> <span class="k">dynamic_cast</span><span class="o">&lt;</span><span class="n">ArticleUpdatedEvent</span><span class="o">*&gt;</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="n">get</span><span class="p">());</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">                <span class="k">if</span> <span class="p">(</span><span class="n">e</span> <span class="o">!=</span> <span class="k">nullptr</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">                    <span class="n">string</span> <span class="n">article</span> <span class="o">=</span> <span class="n">e</span><span class="o">-&gt;</span><span class="n">getArticle</span><span class="p">();</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">                    <span class="n">readArticle</span><span class="p">(</span><span class="n">article</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl">                <span class="p">}</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl">                <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">33</span><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="ln">34</span><span class="cl">            <span class="k">case</span> <span class="n">EventType</span><span class="o">::</span><span class="nl">VIP_ARTICLE_UPDATED</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">35</span><span class="cl">                <span class="k">auto</span> <span class="n">e</span> <span class="o">=</span> <span class="k">dynamic_cast</span><span class="o">&lt;</span><span class="n">VipArticleUpdatedEvent</span><span class="o">*&gt;</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="n">get</span><span class="p">());</span>
</span></span><span class="line"><span class="ln">36</span><span class="cl">                <span class="k">if</span> <span class="p">(</span><span class="n">e</span> <span class="o">!=</span> <span class="k">nullptr</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">37</span><span class="cl">                    <span class="n">string</span> <span class="n">vipArticle</span> <span class="o">=</span> <span class="n">e</span><span class="o">-&gt;</span><span class="n">getArticle</span><span class="p">();</span>
</span></span><span class="line"><span class="ln">38</span><span class="cl">                    <span class="n">readArticle</span><span class="p">(</span><span class="n">vipArticle</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">39</span><span class="cl">                    <span class="kt">int</span> <span class="n">reward</span> <span class="o">=</span> <span class="n">e</span><span class="o">-&gt;</span><span class="n">getReward</span><span class="p">();</span>
</span></span><span class="line"><span class="ln">40</span><span class="cl">                    <span class="n">earnReward</span><span class="p">(</span><span class="n">reward</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">41</span><span class="cl">                <span class="p">}</span>
</span></span><span class="line"><span class="ln">42</span><span class="cl">                <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">43</span><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="ln">44</span><span class="cl">            <span class="k">default</span><span class="o">:</span>
</span></span><span class="line"><span class="ln">45</span><span class="cl">                <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">46</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln">47</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">48</span><span class="cl">
</span></span><span class="line"><span class="ln">49</span><span class="cl">    <span class="kt">void</span> <span class="nf">readArticle</span><span class="p">(</span><span class="n">string</span> <span class="n">article</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">50</span><span class="cl">        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">name</span> <span class="o">&lt;&lt;</span> <span class="s">&#34; is reading article : &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">article</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">51</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">52</span><span class="cl">
</span></span><span class="line"><span class="ln">53</span><span class="cl">    <span class="kt">void</span> <span class="nf">earnReward</span><span class="p">(</span><span class="kt">int</span> <span class="n">reward</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">54</span><span class="cl">        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">name</span> <span class="o">&lt;&lt;</span> <span class="s">&#34; earned reward : &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">reward</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">55</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">56</span><span class="cl">
</span></span><span class="line"><span class="ln">57</span><span class="cl"><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="ln">58</span><span class="cl">    <span class="n">string</span> <span class="n">name</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">59</span><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="ln">60</span><span class="cl">
</span></span><span class="line"><span class="ln">61</span><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">62</span><span class="cl">
</span></span><span class="line"><span class="ln">63</span><span class="cl">    <span class="n">Publisher</span> <span class="n">publisher</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">64</span><span class="cl">
</span></span><span class="line"><span class="ln">65</span><span class="cl">    <span class="n">Subscriber</span> <span class="n">sub1</span><span class="p">(</span><span class="s">&#34;Tom&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">66</span><span class="cl">    <span class="n">publisher</span><span class="p">.</span><span class="n">addObserver</span><span class="p">(</span><span class="o">&amp;</span><span class="n">sub1</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">67</span><span class="cl">    <span class="n">publisher</span><span class="p">.</span><span class="n">addArticle</span><span class="p">(</span><span class="s">&#34;Article 1&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">68</span><span class="cl">
</span></span><span class="line"><span class="ln">69</span><span class="cl">    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">70</span><span class="cl">
</span></span><span class="line"><span class="ln">71</span><span class="cl">    <span class="n">Subscriber</span> <span class="n">sub2</span><span class="p">(</span><span class="s">&#34;Jerry&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">72</span><span class="cl">    <span class="n">publisher</span><span class="p">.</span><span class="n">addObserver</span><span class="p">(</span><span class="o">&amp;</span><span class="n">sub2</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">73</span><span class="cl">    <span class="n">publisher</span><span class="p">.</span><span class="n">addVipArticleWithReward</span><span class="p">(</span><span class="s">&#34;Article 2&#34;</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">74</span><span class="cl">
</span></span><span class="line"><span class="ln">75</span><span class="cl">    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">76</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>æ‰§è¡Œç»“æœï¼š</p>
<pre tabindex="0"><code>Tom is reading article : Article 1

Tom is reading article : Article 2
Tom earned reward : 5
Jerry is reading article : Article 2
Jerry earned reward : 5
</code></pre><p>é€šè¿‡ç»§æ‰¿<code>Event</code>ï¼Œè¿™ä¸ªç‰ˆæœ¬æ”¯æŒçµæ´»çš„æ‰©å±•é€šçŸ¥ç±»å‹ï¼Œå¯¹ä¼ é€’çš„å‚æ•°ä¸ªæ•°å’Œç±»å‹æ²¡æœ‰ä»»ä½•é™åˆ¶ã€‚</p>
<p>ç›®å‰ä¸ºæ­¢ï¼Œè¢«è®¢é˜…å¯¹è±¡å‘é€ <code>notify</code> æ—¶å¯¹æ‰€æœ‰çš„è®¢é˜…è€…éƒ½æ˜¯ä¸€è§†åŒä»çš„ï¼Œä¹Ÿå°±æ˜¯è¯´æ¯ä¸ªè®¢é˜…è€…æ¥æ”¶åˆ°çš„æ¶ˆæ¯æ˜¯ä¸€æ ·çš„ã€‚</p>
<p>å¯¹äºä¸Šé¢å…¬ä¼—å·çš„ä¾‹å­ï¼Œå¦‚æœæƒ³å®ç°å¯¹ VIP è®¢é˜…è€…å’Œæ™®é€šè®¢é˜…è€…æ¨é€ä¸åŒçš„é€šçŸ¥ï¼Œé‚£å°±å¯ä»¥é€šè¿‡å¦‚ä¸‹çš„æ–¹å¼ã€‚</p>
<hr>
<h2 id="è§‚å¯Ÿè€…æ¨¡å¼30">è§‚å¯Ÿè€…æ¨¡å¼3.0</h2>
<p>æ›´æ”¹ <code>Subject</code> çš„è®¢é˜…å’Œé€šçŸ¥æ–¹æ³•ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="ln"> 1</span><span class="cl">
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="c1">// Subject.h
</span></span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="k">class</span> <span class="nc">Subject</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">  <span class="k">virtual</span> <span class="kt">void</span> <span class="n">addObserver</span><span class="p">(</span><span class="n">EventType</span> <span class="n">type</span><span class="p">,</span> <span class="n">Observer</span> <span class="o">*</span> <span class="n">observer</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">  <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">removeObserver</span><span class="p">(</span><span class="n">EventType</span> <span class="n">type</span><span class="p">,</span> <span class="n">Observer</span> <span class="o">*</span> <span class="n">observer</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">  <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">notify</span><span class="p">(</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Event</span><span class="o">&gt;</span> <span class="n">event</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">
</span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">  <span class="n">std</span><span class="o">::</span><span class="n">map</span><span class="o">&lt;</span><span class="n">EventType</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">set</span><span class="o">&lt;</span><span class="n">Observer</span><span class="o">*&gt;</span> <span class="o">&gt;</span> <span class="n">observers</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="c1">// Subjet.cpp
</span></span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="kt">void</span> <span class="n">Subject</span><span class="o">::</span><span class="n">addObserver</span><span class="p">(</span><span class="n">EventType</span> <span class="n">type</span><span class="p">,</span> <span class="n">Observer</span><span class="o">*</span> <span class="n">observer</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">  <span class="n">observers</span><span class="p">[</span><span class="n">type</span><span class="p">].</span><span class="n">insert</span><span class="p">(</span><span class="n">observer</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">
</span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="kt">void</span> <span class="n">Subject</span><span class="o">::</span><span class="n">removeObserver</span><span class="p">(</span><span class="n">EventType</span> <span class="n">type</span><span class="p">,</span> <span class="n">Observer</span><span class="o">*</span> <span class="n">observer</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">  <span class="n">observers</span><span class="p">[</span><span class="n">type</span><span class="p">].</span><span class="n">erase</span><span class="p">(</span><span class="n">observer</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">
</span></span><span class="line"><span class="ln">24</span><span class="cl"><span class="kt">void</span> <span class="n">Subject</span><span class="o">::</span><span class="n">notify</span><span class="p">(</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Event</span><span class="o">&gt;</span> <span class="n">event</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">  <span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="nl">obs</span><span class="p">:</span> <span class="n">observers</span><span class="p">[</span><span class="n">event</span><span class="o">-&gt;</span><span class="n">type</span><span class="p">()])</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">    <span class="n">obs</span><span class="o">-&gt;</span><span class="n">update</span><span class="p">(</span><span class="n">event</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>ä¿®æ”¹<code>main</code>ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">    <span class="n">Publisher</span> <span class="n">publisher</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">    <span class="n">Subscriber</span> <span class="n">sub1</span><span class="p">(</span><span class="s">&#34;Tom&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">    <span class="n">publisher</span><span class="p">.</span><span class="n">addObserver</span><span class="p">(</span><span class="n">EventType</span><span class="o">::</span><span class="n">ARTICLE_UPDATED</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">sub1</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">    <span class="n">publisher</span><span class="p">.</span><span class="n">addArticle</span><span class="p">(</span><span class="s">&#34;Article 1&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">
</span></span><span class="line"><span class="ln">10</span><span class="cl">    <span class="n">Subscriber</span> <span class="n">sub2</span><span class="p">(</span><span class="s">&#34;Jerry&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">    <span class="n">publisher</span><span class="p">.</span><span class="n">addObserver</span><span class="p">(</span><span class="n">EventType</span><span class="o">::</span><span class="n">VIP_ARTICLE_UPDATED</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">sub2</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">    <span class="n">publisher</span><span class="p">.</span><span class="n">addVipArticleWithReward</span><span class="p">(</span><span class="s">&#34;VIP Article 2&#34;</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl">    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>æ‰§è¡Œç»“æœï¼š</p>
<pre tabindex="0"><code>Tom is reading article : Article 1

Jerry is reading article : VIP Article 2
Jerry earned reward : 5
</code></pre><p>æ­¤ç‰ˆæœ¬è¿›åŒ–åˆ°äº†ä¸€ä¸ªæ›´ä¸ºç‰¹æ®Šçš„è§‚å¯Ÿè€…æ¨¡å¼â€”â€”â€”å‘å¸ƒè®¢é˜…è€…æ¨¡å¼ï¼Œæˆ–è€…å«äº‹ä»¶è®¢é˜…æ¨¡å¼ã€‚</p>
<h3 id="observer-pattern-vs-publish-subscribe-pattern">Observer Pattern v.s. Publish-Subscribe Pattern</h3>
<p>å…¶ä¸»è¦åŒºåˆ«æ˜¯è§‚å¯Ÿè€…æ¨¡å¼æ¶‰åŠä¸¤ç§è§’è‰² <code>Subject</code> å’Œ <code>Observer</code>ï¼Œè€Œå‘å¸ƒè®¢é˜…æ¨¡å¼ä¸­é—´å¤šäº†ä¸€ä¸ª<code>Event</code>å¤„ç†ï¼Œæœ‰çš„ç§°ä¹‹ä¸º<code>Broker</code>æˆ–<code>Channel</code>:</p>
<p></p>
<hr>
<h2 id="å®Œæ•´ä»£ç ">å®Œæ•´ä»£ç </h2>
<ul>
<li><a href="https://github.com/AidySun/aidysun.github.io/tree/main/src/design-pattern-observer.v1.0.cpp">design-pattern-observer v1.0.cpp</a></li>
<li><a href="https://github.com/AidySun/aidysun.github.io/tree/main/src/design-pattern-observer.v2.0.cpp">design-pattern-observer v2.0.cpp</a></li>
<li><a href="https://github.com/AidySun/aidysun.github.io/tree/main/src/design-pattern-observer.v3.0.cpp">design-pattern-observer v3.0.cpp</a></li>
</ul>
]]></content:encoded>
    </item>
    
    <item>
      <title>Swift: beginAnimations(_:context:) was deprecated in iOS 13.0: Use the block-based animation API instead</title>
      <link>https://aidysun.github.io/posts/2023/04/swift-block-based-animation/</link>
      <pubDate>Sun, 02 Apr 2023 00:00:00 +0000</pubDate>
      
      <guid>https://aidysun.github.io/posts/2023/04/swift-block-based-animation/</guid>
      <description>Swift / Objective-C block-based animation</description>
      <content:encoded><![CDATA[<p>ç”¨ <code>Xcode 14.2</code> å‡çº§ä¸€ä¸ª <code>Swift</code> é¡¹ç›®æ—¶æœ‰ç¼–è¯‘è­¦å‘Šï¸âš æç¤º <code>beginAnimations()</code> åœ¨ <code>iOS 13.0</code> åå·²ç»ä¸æ¨èä½¿ç”¨ï¼Œåº”è¯¥ç”¨ <code>block-based animation</code> ä»£æ›¿ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-swift" data-lang="swift"><span class="line hl"><span class="ln">1</span><span class="cl"><span class="n">UIView</span><span class="p">.</span><span class="n">beginAnimations</span><span class="p">(</span><span class="kc">nil</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="kc">nil</span><span class="p">)</span> <span class="c1">// &#39;beginAnimations(_:context:)&#39; was deprecated in iOS 13.0: Use the block-based animation API instead</span>
</span></span><span class="line hl"><span class="ln">2</span><span class="cl"><span class="n">UIView</span><span class="p">.</span><span class="n">setAnimationDuration</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span> <span class="c1">// &#39;setAnimationDuration&#39; was deprecated in iOS 13.0: Use the block-based animation API instead</span>
</span></span><span class="line hl"><span class="ln">3</span><span class="cl"><span class="n">UIView</span><span class="p">.</span><span class="n">commitAnimations</span><span class="p">()</span> <span class="c1">// &#39;commitAnimations()&#39; was deprecated in iOS 13.0: Use the block-based animation API instead </span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">
</span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="n">currentOverlay</span> <span class="p">=</span> <span class="n">overlay</span>
</span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="n">currentOverlayTarget</span> <span class="p">=</span> <span class="n">overlayTarget</span>
</span></span><span class="line"><span class="ln">7</span><span class="cl"><span class="n">currentLoadingText</span> <span class="p">=</span> <span class="n">loadingText</span></span></span></code></pre></div>
<p>ä¿®æ”¹ä¸ºä½¿ç”¨ <code>Block-based animation</code> çš„ä»£ç ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-swift" data-lang="swift"><span class="line"><span class="ln">1</span><span class="cl"><span class="n">UIView</span><span class="p">.</span><span class="n">animate</span><span class="p">(</span><span class="n">withDuration</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">    <span class="n">currentOverlay</span> <span class="p">=</span> <span class="n">overlay</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">    <span class="n">currentOverlayTarget</span> <span class="p">=</span> <span class="n">overlayTarget</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">    <span class="n">currentLoadingText</span> <span class="p">=</span> <span class="n">loadingText</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>å¦‚æœç”¨ <code>Objective-C</code> åˆ™ä¿®æ”¹å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-objc" data-lang="objc"><span class="line"><span class="ln">1</span><span class="cl"><span class="p">[</span><span class="n">UIView</span> <span class="nl">animateWithDuration</span><span class="p">:</span> <span class="mf">0.5</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">                 <span class="nl">animations</span><span class="p">:</span> <span class="o">^</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">    <span class="n">currentOverlay</span> <span class="o">=</span> <span class="n">overlay</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">    <span class="n">currentOverlayTarget</span> <span class="o">=</span> <span class="n">overlayTarget</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl">    <span class="n">currentLoadingText</span> <span class="o">=</span> <span class="n">loadingText</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="p">}];</span>
</span></span></code></pre></div>]]></content:encoded>
    </item>
    
    <item>
      <title>Markdown è·¯å¾„ä¸­æœ‰ç©ºæ ¼çš„é“¾æ¥(link)</title>
      <link>https://aidysun.github.io/posts/2023/03/markdown-link-to-url-with-space/</link>
      <pubDate>Thu, 30 Mar 2023 21:17:22 +0800</pubDate>
      
      <guid>https://aidysun.github.io/posts/2023/03/markdown-link-to-url-with-space/</guid>
      <description>Markdown ä¸­åŠ å…¥è¶…é“¾æ¥æŒ‡å‘æ–‡ä»¶ï¼Œä½†æ–‡ä»¶åä¸­åŒ…å«ç©ºæ ¼ï¼Œæ€ä¹ˆåŠï¼Ÿ</description>
      <content:encoded><![CDATA[<h2 id="æ–¹æ³•ä¸€-å°†ç©ºæ ¼æ›¿æ¢ä¸º20">æ–¹æ³•ä¸€ï¼š å°†ç©ºæ ¼æ›¿æ¢ä¸º<code>%20</code></h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-markdown" data-lang="markdown"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">-</span> [<span class="nt">ç™¾åº¦æœç´¢ markdown link space</span>](<span class="na">https://www.baidu.com/s?wd=markdown%20link%20space</span>)
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="k">-</span> [<span class="nt">çˆ¶ç›®å½•ä¸­çš„READ ME.md</span>](<span class="na">../READ%20ME.md</span>) 
</span></span></code></pre></div><p>æ•ˆæœï¼š</p>
<ul>
<li><a href="https://www.baidu.com/s?wd=markdown%20link%20space">ç™¾åº¦æœç´¢ markdown link space</a></li>
<li><a href="../READ%20ME.md">çˆ¶ç›®å½•ä¸­çš„READ ME.md</a> <code>ğŸ•·ï¸404é¢„è­¦</code></li>
</ul>
<h2 id="æ–¹æ³•äºŒ-ç”¨--æŠŠå¸¦ç©ºæ ¼çš„è·¯å¾„urlæ‹¬èµ·æ¥">æ–¹æ³•äºŒï¼š ç”¨ <code>&lt;&gt;</code> æŠŠå¸¦ç©ºæ ¼çš„è·¯å¾„/URLæ‹¬èµ·æ¥</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-markdown" data-lang="markdown"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">-</span> [<span class="nt">Bingæœç´¢ markdown link with space</span>](<span class="na">&lt;https://cn.bing.com/search?q=markdown link with space&gt;</span>)
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="k">-</span> [<span class="nt">çˆ¶ç›®å½•ä¸­çš„READ ME.md</span>](<span class="na">&lt;../READ ME.md&gt;</span>)
</span></span></code></pre></div><ul>
<li><a href="https://cn.bing.com/search?q=markdown%20link%20with%20space">Bingæœç´¢ markdown link with space</a></li>
<li><a href="../READ%20ME.md">çˆ¶ç›®å½•ä¸­çš„READ ME.md</a> <code>ğŸ404é¢„è­¦</code></li>
</ul>
]]></content:encoded>
    </item>
    
    <item>
      <title>hugo ä¸»é¢˜æœ¬åœ°æ²¡é—®é¢˜ï¼Œgithub.ioä¸­ä¸èµ·ä½œç”¨</title>
      <link>https://aidysun.github.io/posts/2023/03/hugo-theme-not-work-online/</link>
      <pubDate>Tue, 28 Mar 2023 00:00:00 +0000</pubDate>
      
      <guid>https://aidysun.github.io/posts/2023/03/hugo-theme-not-work-online/</guid>
      <description>Failed to find a valid digest in the &amp;#39;integrity&amp;#39; attribute for resource &amp;#39;https://.....css&amp;#39; with computed SHA-256 integrity &amp;#39;.....&amp;#39;. The resource has been blocked.</description>
      <content:encoded><![CDATA[<p><strong>æ ¹æœ¬åŸå› ï¼š<code>git crlf</code> è®¾ç½®å¯¼è‡´æ¨é€åˆ° <code>github</code> çš„æ–‡ä»¶å˜åŠ¨ã€‚</strong></p>
<p><code>Hugo</code> é™æ€åšå®¢ï¼Œä½¿ç”¨ <code>PaperMode</code> ä¸»é¢˜ï¼Œæœ¬åœ°æ¸²æŸ“æ²¡é—®é¢˜ï¼Œå°† <code>publish</code> æ–‡ä»¶å¤¹ <code>push</code> åˆ° <code>&lt;username&gt;.github.io</code> åï¼Œé€šè¿‡ Github Page è®¿é—®ä¼šå‡ºç° <code>CSS block</code> çš„æƒ…å†µï¼š</p>
<p></p>
<h2 id="å°è¯•è¿‡ä½†ä¸èµ·ä½œç”¨çš„æ–¹æ³•">å°è¯•è¿‡ä½†ä¸èµ·ä½œç”¨çš„æ–¹æ³•</h2>
<ol>
<li>ä¿®æ”¹ <code>config.toml</code> ä¸­çš„ <code>baseURL</code>ï¼Œç”¨ <code>http</code>ã€ç”¨ <code>https</code>ã€‚</li>
<li>æ ¹æ® <a href="https://github.com/kylethedeveloper/hugo-PaperMod/commit/1b9352398fe91fab207337352befee77152cc544">head, footer: add option to disable fingerprinting adityatelange#89</a>, åœ¨ <code>config.toml</code> ä¸­åŠ å…¥å¦‚ä¸‹å†…å®¹:</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-toml" data-lang="toml"><span class="line"><span class="ln">1</span><span class="cl"><span class="p">[</span><span class="nx">params</span><span class="p">.</span><span class="nx">assets</span><span class="p">]</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">  <span class="nx">disableFingerprinting</span> <span class="p">=</span> <span class="kc">true</span>
</span></span></code></pre></div><h2 id="æˆ‘çš„è§£å†³æ–¹æ³•">æˆ‘çš„è§£å†³æ–¹æ³•</h2>
<p>æ ¹æ® <a href="https://github.com/lxndrblz/anatole/issues/114">Failed to find a valid digest in the integrity attribute</a>ï¼Œé—®é¢˜å¯èƒ½æ˜¯ <code>git</code> <code>line breaking</code> çš„é—®é¢˜ï¼Œæˆ‘ä½¿ç”¨çš„æ˜¯ <code>macOS</code>ï¼Œå½“æ—¶çš„ <code>git config -l</code> ä¸­:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="ln">1</span><span class="cl">core.autocrlf<span class="o">=</span><span class="nb">true</span>
</span></span></code></pre></div><p>åœ¨ <code>hugo project repo</code> å’Œ æˆ‘çš„ <code>github.io</code> repo ä¸­ æ‰§è¡Œ</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="ln">1</span><span class="cl">git config core.autocrlf <span class="nb">false</span>
</span></span></code></pre></div><p>ç„¶åç”Ÿæˆåšå®¢ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="ln">1</span><span class="cl"><span class="nb">cd</span> blog-hugo
</span></span><span class="line"><span class="ln">2</span><span class="cl">hugo -t PaperMod
</span></span><span class="line"><span class="ln">3</span><span class="cl">
</span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="c1"># publish is &lt;username&gt;.github.io repo as a submodule</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="nb">cd</span> publish
</span></span><span class="line"><span class="ln">6</span><span class="cl">git add .
</span></span><span class="line"><span class="ln">7</span><span class="cl">git commit -m <span class="s2">&#34;fix online theme&#34;</span>
</span></span><span class="line"><span class="ln">8</span><span class="cl">git push
</span></span></code></pre></div><p>å®Œç¾è§£å†³ï¼š</p>
<p></p>
<h2 id="å…¶å®ƒæœªå°è¯•çš„æ–¹æ³•">å…¶å®ƒæœªå°è¯•çš„æ–¹æ³•</h2>
<ul>
<li>ä¿®æ”¹æ¨¡ç‰ˆä¸­çš„ <code>integrity=&quot;{{ xxxx }}&quot;</code> ä¸º <code>integrity=&quot;&quot;</code></li>
<li><code>git config --global core.autocrlf input</code></li>
<li><a href="https://swopnil.com/blog/valid-digest-integrity-error-hugo-styling/">CloudFlare Cache</a></li>
</ul>
]]></content:encoded>
    </item>
    
    <item>
      <title>èƒ½å¦åœ¨ C&#43;&#43; çš„æ„é€ å‡½æ•°ä¸­ä½¿ç”¨ this æŒ‡é’ˆ</title>
      <link>https://aidysun.github.io/posts/2023/03/this-pointer-in-cpp-ctor/</link>
      <pubDate>Mon, 27 Mar 2023 22:07:21 +0800</pubDate>
      
      <guid>https://aidysun.github.io/posts/2023/03/this-pointer-in-cpp-ctor/</guid>
      <description>æ„é€ å‡½æ•°æ²¡æ‰§è¡Œå®Œï¼Œthisä¸å¯ä»¥ç”¨ï¼Ÿç»§æ‰¿å¤šæ€ä¸­çˆ¶ç±»èƒ½å¦ç”¨thisæŒ‡é’ˆè§¦å‘å¤šæ€è°ƒç”¨ï¼Ÿ</description>
      <content:encoded><![CDATA[<p>ç›´æ¥è¯´ç»“è®ºï¼š<strong>å¯ä»¥åœ¨æ„é€ å‡½æ•°ä¸­ä½¿ç”¨ thisï¼Œä½†æ˜¯ï¼Œå¤šæ€æ— æ³•ç”Ÿæ•ˆã€‚</strong></p>
<p>æœ‰äººè®¤ä¸ºåœ¨æ„é€ å‡½æ•°ä¸­ï¼Œå¯¹è±¡çš„æ„é€ è¿˜æ²¡æœ‰å®Œæˆï¼Œä¸èƒ½ä½¿ç”¨ this æŒ‡é’ˆã€‚
æ ¹æ®<a href="https://isocpp.org/wiki/faq/ctors#using-this-in-ctors">Should you use the this pointer in the constructor?</a>çš„æè¿°ï¼Œåœ¨æ„é€ å‡½æ•°çš„å‡½æ•°ä½“ä¸­ä½¿ç”¨thisæŒ‡é’ˆå¯ä»¥æ”¾å¿ƒçš„è®¿é—®çˆ¶ç±»å’Œè‡ªå·±ç±»ä¸­å®šä¹‰çš„æ•°æ®æˆå‘˜ï¼ˆdata membersï¼‰ã€‚å› ä¸ºé‚£äº›æ•°æ®æˆå‘˜åœ¨æ„é€ å‡½æ•°å¼€å§‹æ‰§è¡Œæ—¶å·²ç»æ„é€ å®Œæˆäº†ã€‚</p>
<blockquote>
<p>Here is something that always works: the {body} of a constructor (or a function called from the constructor) can reliably access the data members declared in a base class and/or the data members declared in the constructorâ€™s own class. This is because all those data members are guaranteed to have been fully constructed by the time the constructorâ€™s {body} starts executing.</p>
</blockquote>
<p>ä½†è¦<strong>æ³¨æ„</strong>åœ¨æœ‰ç»§æ‰¿çš„æƒ…å†µä¸‹ï¼Œå³ä½¿æ˜¯æ­£åœ¨æ„é€ ä¸€ä¸ªå­ç±»å®ä¾‹ï¼Œåœ¨çˆ¶ç±»çš„æ„é€ é˜¶æ®µï¼Œå½“å‰çš„å®ä¾‹è¿˜ä¸æ˜¯å­ç±»å‹ã€‚</p>
<blockquote>
<p>The bottom line is this: even if the caller is constructing an object of a derived class, during the constructor of the base class, your object is not yet of that derived class. You have been warned.</p>
</blockquote>
<p>è¿™ä¹Ÿå°±å¯¼è‡´äº†åœ¨çˆ¶ç±»çš„æ„é€ å‡½æ•°ä¸­ï¼ŒthisæŒ‡é’ˆæ˜¯æ— æ³•è§¦å‘å¤šæ€ï¼Œä¹Ÿå°±æ˜¯æ— æ³•è°ƒç”¨åˆ°æ­£ç¡®çš„è™šå‡½æ•°ï¼ˆvirtual functionsï¼‰ã€‚</p>
<blockquote>
<p>Here is something that never works: the {body} of a constructor (or a function called from the constructor) cannot get down to a derived class by calling a virtual member function that is overridden in the derived class. If your goal was to get to the overridden function in the derived class, you wonâ€™t get what you want. Note that you wonâ€™t get to the override in the derived class independent of how you call the virtual member function: explicitly using the this pointer (e.g., this-&gt;method()), implicitly using the this pointer (e.g., method()), or even calling some other function that calls the virtual member function on your this object.</p>
</blockquote>
<p>å¯ä»¥ç”¨å¦‚ä¸‹çš„ä¾‹å­ç±»éªŒè¯ä¸€ä¸‹ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="k">class</span> <span class="nc">A</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">  <span class="n">A</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;A() { </span><span class="se">\n</span><span class="s">&#34;</span><span class="p">;</span>
</span></span><span class="line hl"><span class="ln">10</span><span class="cl">    <span class="k">this</span><span class="o">-&gt;</span><span class="n">vf</span><span class="p">();</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">    <span class="k">this</span><span class="o">-&gt;</span><span class="n">f1</span><span class="p">();</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;} </span><span class="se">\n</span><span class="s">&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">
</span></span><span class="line"><span class="ln">15</span><span class="cl">  <span class="o">~</span><span class="n">A</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;~A()</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">
</span></span><span class="line"><span class="ln">19</span><span class="cl">  <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">vf</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;  A&#39;s vf()</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">
</span></span><span class="line"><span class="ln">23</span><span class="cl">  <span class="kt">void</span> <span class="nf">f1</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;  A&#39;s f1()</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">;</span>
</span></span><span class="line hl"><span class="ln">25</span><span class="cl">    <span class="n">vf</span><span class="p">();</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">
</span></span><span class="line"><span class="ln">29</span><span class="cl"><span class="k">class</span> <span class="nc">B</span> <span class="o">:</span> <span class="k">public</span> <span class="n">A</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">
</span></span><span class="line"><span class="ln">31</span><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl">  <span class="n">B</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">33</span><span class="cl">    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;B() { </span><span class="se">\n</span><span class="s">&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">34</span><span class="cl">    <span class="k">this</span><span class="o">-&gt;</span><span class="n">vf</span><span class="p">();</span>
</span></span><span class="line"><span class="ln">35</span><span class="cl">    <span class="k">this</span><span class="o">-&gt;</span><span class="n">f1</span><span class="p">();</span>
</span></span><span class="line"><span class="ln">36</span><span class="cl">    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;} </span><span class="se">\n</span><span class="s">&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">37</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln">38</span><span class="cl">  
</span></span><span class="line"><span class="ln">39</span><span class="cl">  <span class="o">~</span><span class="n">B</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">40</span><span class="cl">    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;~B()</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">41</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln">42</span><span class="cl">
</span></span><span class="line"><span class="ln">43</span><span class="cl">  <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">vf</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">44</span><span class="cl">    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;  B&#39;s vf()</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">45</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln">46</span><span class="cl">
</span></span><span class="line"><span class="ln">47</span><span class="cl">  <span class="kt">void</span> <span class="nf">f1</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">48</span><span class="cl">    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;  B&#39;s f1()</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">49</span><span class="cl">    <span class="n">vf</span><span class="p">();</span>
</span></span><span class="line"><span class="ln">50</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln">51</span><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="ln">52</span><span class="cl">
</span></span><span class="line"><span class="ln">53</span><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">54</span><span class="cl">  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;creat A a</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">55</span><span class="cl">  <span class="n">A</span> <span class="n">a</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">56</span><span class="cl">  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;creat B b</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">;</span>
</span></span><span class="line hl"><span class="ln">57</span><span class="cl">  <span class="n">B</span> <span class="n">b</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">58</span><span class="cl">
</span></span><span class="line"><span class="ln">59</span><span class="cl">  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;======</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">60</span><span class="cl">  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">61</span><span class="cl"><span class="p">}</span></span></span></code></pre></div>
<p>æ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="ln"> 1</span><span class="cl">creat A a
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">A<span class="o">()</span> <span class="o">{</span> 
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  A<span class="s1">&#39;s vf()
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="s1">  A&#39;</span>s f1<span class="o">()</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">  A<span class="s1">&#39;s vf()
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="s1">} 
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="s1">creat B b  // å¼€å§‹æ„é€  B b;
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="s1">A() { 
</span></span></span><span class="line hl"><span class="ln"> 9</span><span class="cl"><span class="s1">  A&#39;</span>s vf<span class="o">()</span> // åœ¨Bçš„æ„é€ è¿‡ç¨‹ä¸­ï¼Œçˆ¶ç±»Aä¸­çš„thisè°ƒç”¨çš„æ˜¯Açš„virtual <span class="k">function</span> 
</span></span><span class="line"><span class="ln">10</span><span class="cl">  A<span class="s1">&#39;s f1()
</span></span></span><span class="line hl"><span class="ln">11</span><span class="cl"><span class="s1">  A&#39;</span>s vf<span class="o">()</span> // åŒæ ·ï¼Œåœ¨çˆ¶ç±»æ„é€ å‡½æ•°ä¸­é—´æ¥è°ƒç”¨çš„è™šå‡½æ•°ï¼Œä¹Ÿä¸ä¼šè°ƒç”¨å­ç±»çš„è™šå‡½æ•°
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="o">}</span> 
</span></span><span class="line"><span class="ln">13</span><span class="cl">B<span class="o">()</span> <span class="o">{</span> 
</span></span><span class="line"><span class="ln">14</span><span class="cl">  B<span class="s1">&#39;s vf()
</span></span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="s1">  B&#39;</span>s f1<span class="o">()</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">  B<span class="err">&#39;</span>s vf<span class="o">()</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="o">}</span> 
</span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="o">======</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">~B<span class="o">()</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">~A<span class="o">()</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">~A<span class="o">()</span></span></span></code></pre></div>
]]></content:encoded>
    </item>
    
    <item>
      <title>å¦‚ä½•åˆ é™¤æœ¬åœ° git ä¸­æœªè¿½è¸ªçš„æ–‡ä»¶/æ–‡ä»¶å¤¹</title>
      <link>https://aidysun.github.io/posts/2023/03/git-rm-untracked-file-dir/</link>
      <pubDate>Fri, 24 Mar 2023 00:00:00 +0000</pubDate>
      
      <guid>https://aidysun.github.io/posts/2023/03/git-rm-untracked-file-dir/</guid>
      <description>git clean</description>
      <content:encoded><![CDATA[<p>å¯¹äºä¸€ä¸ª git é¡¹ç›®ï¼Œæ‰§è¡Œ <code>git status -u</code> æœ‰å¦‚ä¸‹çŠ¶æ€ï¼š</p>
<p></p>
<p>å¯¹äºæœ¬åœ°æ–°å¢çš„æ–‡ä»¶ï¼Œå¯ä»¥é€šè¿‡ <code>clean</code> å‘½ä»¤ç›´æ¥åˆ é™¤ï¼š</p>
<p></p>
<p></p>
<p>ä½†æ˜¯æœ¬åœ°æ–°å¢çš„æ–‡ä»¶å¤¹å´æ²¡æœ‰è¢«åˆ é™¤æ‰ã€‚è¦åˆ é™¤æ–‡ä»¶å¤¹éœ€è¦åŠ ä¸Š <code>-d</code> å‚æ•°ï¼š</p>
<p></p>
<p>è¿˜æœ‰ä¸€ç§æƒ…å†µå°±æ˜¯å·²ç»åœ¨ <code>.gitignore</code> ä¸­çš„æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹æ˜¯ä¸ä¼šè¢«åˆ é™¤çš„ã€‚</p>
<p></p>
<p></p>
<p>éœ€è¦é€šè¿‡ <code>-x</code> é€‰é¡¹æ¥åˆ é™¤è¢« <code>.gitignore</code> åŒ…å«çš„æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹ï¼š</p>
<p></p>
<h2 id="git-clean-options"><code>git clean</code> options</h2>
<table>
<thead>
<tr>
<th style="text-align:center">Option</th>
<th>Comments</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><code>-f</code></td>
<td><em>Delete files or diretories</em></td>
</tr>
<tr>
<td style="text-align:center"><code>-d</code></td>
<td><em>Recurse into untracked directories</em></td>
</tr>
<tr>
<td style="text-align:center"><code>-x</code></td>
<td><em>Donâ€™t use the standard ignore rules</em></td>
</tr>
</tbody>
</table>
]]></content:encoded>
    </item>
    
    <item>
      <title></title>
      <link>https://aidysun.github.io/posts/drafts/cpp-smart-pointer-and-dynamic-array/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>https://aidysun.github.io/posts/drafts/cpp-smart-pointer-and-dynamic-array/</guid>
      <description>C++ ä¸­æ²¡æœ‰åƒåœ¾å›æ”¶ï¼ŒåŠ¨æ€ç”³è¯·çš„å†…å­˜éœ€è¦æ‰‹åŠ¨é‡Šæ”¾ã€‚ ã€Œæ™ºèƒ½æŒ‡é’ˆã€æ˜¯ C++ ä¸­ç®¡ç†åŠ¨æ€å†…å­˜ã€é˜²æ­¢èµ„æºæ³„æ¼çš„ä¸€ç§æ•°æ®ç»“æ„ã€‚ ã€ŒåŠ¨æ€æ•°ç»„ã€æŒ‡çš„æ˜¯é€šè¿‡ operator new[] ç”³è¯·çš„æ•°</description>
      <content:encoded><![CDATA[<p>C++ ä¸­æ²¡æœ‰åƒåœ¾å›æ”¶ï¼ŒåŠ¨æ€ç”³è¯·çš„å†…å­˜éœ€è¦æ‰‹åŠ¨é‡Šæ”¾ã€‚</p>
<p>ã€Œæ™ºèƒ½æŒ‡é’ˆã€æ˜¯ C++ ä¸­ç®¡ç†åŠ¨æ€å†…å­˜ã€é˜²æ­¢èµ„æºæ³„æ¼çš„ä¸€ç§æ•°æ®ç»“æ„ã€‚</p>
<p>ã€ŒåŠ¨æ€æ•°ç»„ã€æŒ‡çš„æ˜¯é€šè¿‡ operator new[] ç”³è¯·çš„æ•°ç»„ã€‚</p>
<p>ã€ŒåŠ¨æ€æ•°ç»„ã€æ˜¯åŠ¨æ€å†…å­˜ï¼Œå¹¶ä¸”ã€Œæ™ºèƒ½æŒ‡é’ˆã€æ˜¯ç”¨æ¥ç®¡ç†åŠ¨æ€å†…å­˜çš„ã€‚ä½†æ˜¯å®ƒä»¬çš„åˆä½œå´ä¸ç®€å•ã€‚</p>
<p>å•ä¸ªåŠ¨æ€å¯¹è±¡ v.s. åŠ¨æ€æ•°ç»„</p>
<p>å†…å­˜ç®¡ç†ç®€å•æ¥è¯´å¯ä»¥æè¿°ä¸ºï¼šé€šè¿‡ new æ¥ç”³è¯·å†…å­˜ï¼Œé€šè¿‡ delete æ¥é‡Šæ”¾å†…å­˜ï¼Œæ¯ä¸ª new å¯¹åº”ä¸€ä¸ª deleteã€‚æ™ºèƒ½æŒ‡é’ˆåˆ©ç”¨å¯¹è±¡çš„ææ„å‡½æ•°æ¥è‡ªåŠ¨è°ƒç”¨ delete ã€‚</p>
<p>char* p = new char(&lsquo;a&rsquo;);
// &hellip;
delete p;</p>
<p>é—®é¢˜æ˜¯å•ä¸ªå¯¹è±¡å’Œæ•°ç»„å¯¹è±¡æ‰€ç”¨çš„æ“ä½œç¬¦æ˜¯ä¸ä¸€æ ·çš„ã€‚ä¸Šé¢çš„ä»£ç æ˜¯å•ä¸ªå¯¹è±¡ï¼Œå¯ä»¥ç”¨ C++ ä¸­çš„æ™ºèƒ½æŒ‡é’ˆ auto_ptr, shared_ptr, unique_ptræ¥æ­£ç¡®ç®¡ç†ã€‚</p>
<p>è€Œå¯¹äºåŠ¨æ€æ•°ç»„çš„ operator new[] éœ€è¦é€šè¿‡ operator delete[] æ¥é‡Šæ”¾å†…å­˜ï¼Œè¿™æ—¶æ™ºèƒ½æŒ‡é’ˆå°±ä¸ä¸€å®šèƒ½æ­£ç¡®å·¥ä½œäº†ã€‚</p>
<p>ç”¨ã€Œæ™ºèƒ½æŒ‡é’ˆã€ç®¡ç†ã€ŒåŠ¨æ€æ•°ç»„ã€</p>
<p>std::vector</p>
<p>1</p>
<p>æœ€ç›´æ¥çš„åŠæ³•å°±æ˜¯ä¸ç”¨åŠ¨æ€æ•°ç»„ï¼Œè€Œä½¿ç”¨ std::vector æ¥ä»£æ›¿ã€‚è¿™æ ·å°±ä¸éœ€è¦æ‰‹åŠ¨ç®¡ç†å†…å­˜ã€‚</p>
<p>boost::shared_array</p>
<p>2</p>
<p>Boost ä¸­é’ˆæ™ºèƒ½æŒ‡é’ˆ shared_array ä¸“é—¨ä¸ºè§£å†³è¿™ä¸ªé—®é¢˜è€Œç”Ÿã€‚å¦‚æœä½ çš„é¡¹ç›®ä¸­ä½¿ç”¨äº† Boost åº“ï¼Œè¿™ä¼šæ˜¯ä¸€ä¸ªè½»æ¾çš„è§£å†³æ–¹æ³•ã€‚</p>
<p>boost::shared_ptr&lt;int[]&gt; p(new int[10]);</p>
<p>æŒ‡å®š shared_ptr çš„ deleter</p>
<p>3</p>
<p>åœ¨ C++17 ä»¥å‰ï¼Œshared_ptr ä¸å¯ä»¥ç›´æ¥ç”¨æ¥ç®¡ç†åŠ¨æ€æ•°ç»„ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡æŒ‡å®š deleter çš„æ–¹å¼æ¥ä½¿ç”¨ã€‚</p>
<p>std::shared_ptr<!-- raw HTML omitted --> p(new int[10],
std::default_delete&lt;int[]&gt;());</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ shared_ptr&lt;&gt; ä¸­çš„ç±»å‹æ˜¯ intï¼Œè€Œ default_delete&lt;&gt; ä¸­çš„ç±»å‹æ˜¯ int[]ã€‚</p>
<p>C++11 ä¸­çš„ unique_ptr</p>
<p>4</p>
<p>å¦‚æœä½ çš„é¡¹ç›®ä¸­ä½¿ç”¨äº† C++11ï¼Œé‚£ä¹ˆå¯ä»¥ç”¨ unique_ptr å¯ä»¥ç”¨æ¥ç®¡ç†åŠ¨æ€æ•°ç»„ã€‚</p>
<p>std::unique_ptr&lt;int[]&gt; p(new int[10]);</p>
<p>æ³¨æ„ unique_ptr&lt;&gt; ä¸­çš„ç±»å‹æ˜¯ int[]ã€‚å¦å¤–ä½¿ç”¨æ—¶è¯·æ³¨æ„ unique_ptr çš„ç‰¹ç‚¹ã€‚</p>
<p>C++17 ä¸­çš„ shared_ptr</p>
<p>5</p>
<p>ç»ˆäºï¼Œä» C++17 å¼€å§‹ï¼Œ shared_ptr å¯ä»¥ç”¨äºç®¡ç†åŠ¨æ€æ•°ç»„ã€‚</p>
<p>std::shared_ptr&lt;int[]&gt; p(new int[10]);</p>
<p>æ³¨æ„ shared_ptr&lt;&gt; ä¸­çš„ç±»å‹æ˜¯ int[]ã€‚</p>
]]></content:encoded>
    </item>
    
  </channel>
</rss>
